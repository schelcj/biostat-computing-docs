<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<title>Biostatistics Cluster Examples - R</title>
	<link type="text/css" rel="stylesheet" href="/css/sph.css"/>
	<link type="text/css" rel="stylesheet" href="/biostat/css/stylesheet.css"/>
	<link type="text/css" rel="stylesheet" href="/biostat/computing/overrides.css"/>
<link rel="stylesheet" type="text/css" href="/css/print.css" media="print" />
<link rel="stylesheet" type="text/css" href="/css/mobile.css" media="handheld" />
	<meta name="breadcrumb" content="sph|biostat|computing|cluster|examples"/>
	<meta name="alt_formats" content="txt"/>
</head>
<body>
<!--#include virtual="/biostat/computing/header.shtml" -->

<h1 id="r">R</h1>

<h2 id="rwithsnowfall">R with snow(fall)</h2>

<p>The snow and snowfall packages can be used in R to simplify the process of
writing parallel R scripts. These packages work by creating separate R processes
(slaves/nodes) and then sending jobs to those nodes in parellel. You have a
couple different options for communication between these nodes. The options are
communicationare <a href="http://en.wikipedia.org/wiki/Unix_domain_socket">SOCKETS</a>, <a href="http://en.wikipedia.org/wiki/Message_Passing_Interface">MPI</a>, and <a href="http://en.wikipedia.org/wiki/Parallel_Virtual_Machine">PVM</a>. The biostatistics cluster does not implement
<a href="http://en.wikipedia.org/wiki/Parallel_Virtual_Machine">PVM</a> leaving you with a choice between <a href="http://en.wikipedia.org/wiki/Message_Passing_Interface">MPI</a> and <a href="http://en.wikipedia.org/wiki/Unix_domain_socket">SOCKETS</a>. The basic difference between
the two is that <a href="http://en.wikipedia.org/wiki/Unix_domain_socket">SOCKETS</a> only allow communication within a single host and MPI
communicates across the network. When you submit a R job to the cluster using
snow/snowfall you should consider how many R cluster nodes you wish to start as
this will help you decide which type you need to use. You can think of the snow/snowfall
nodes as <strong>1:1</strong> with cores and nodes, each node you start will use a single core.
If you need to start more slaves then a single cluster node has cores then you
will need to use MPI so those R slaves can communicate across the network.</p>

<p>Here are some examples of sbatch batch file for each type:</p>

<h3 id="snowsnowfallnodetypesock">Snow/Snowfall node type SOCK</h3>

<p>This is a sample of initializing your cluster in snow and snowfall.</p>

<p>snow cluster init sample</p>

<pre><code>cl &lt;- makeCluster(12, type=&quot;SOCK&quot;)
</code></pre>

<p>snowfall cluster init sample</p>

<pre><code>cl &lt;- sfInit(parallel=T,cpus=12,type=&quot;SOCK&quot;)
</code></pre>

<p>This batch script tells the scheduler that you would like this job to
allocate 12 cpus(cores) per task, so 12 cores for 12 snow/snowfall nodes,
that it will run for one day and requires 2GB of memory.</p>

<pre><code>$ cat sock-job.txt
#!/bin/sh
#SBATCH --mail-type=ALL
#SBATCH --mail-user=uniqname@umich.edu
#SBATCH --cpus-per-task=12
#SBATCH --time=1-0
#SBATCH --job-name=test_r_socket_job
#SBATCH --mem=2000

srun R CMD BATCH ./script.R
</code></pre>

<h3 id="snowsnowfallnodetypempi">Snow/Snowfall node type MPI</h3>

<p>This is a sample of initializing your cluster in snow and snowfall.
snow cluster init sample</p>

<pre><code>makeCluster(100, type=&quot;MPI&quot;)
</code></pre>

<p>snowfall cluster init sample</p>

<pre><code>sfInit(parallel=T,cpus=100,type=&quot;MPI&quot;)
</code></pre>

<p>This batch script tells the scheduler that you would like to allocate 100
cpus(cores) to this single task, giving you 100 snow/snowfall nodes, that
it will run for one day and requires 2GB of memory.</p>

<pre><code>$ cat mpi-job.txt
#!/bin/sh
#SBATCH --mail-type=ALL
#SBATCH --mail-user=uniqname@umich.edu
#SBATCH --ntasks=100
#SBATCH --time=1-0
#SBATCH --job-name=test_r_socket_job
#SBATCH --mem=2000

R CMD BATCH ./script.R
</code></pre>

<!--#include virtual="/biostat/computing/footer.shtml" -->
</body>
</html>
